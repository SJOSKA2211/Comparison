Starting tests...
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0 -- /home/jules/.pyenv/versions/3.12.12/bin/python
cachedir: .pytest_cache
rootdir: /app
configfile: pyproject.toml
plugins: anyio-4.12.1
collecting ... collected 39 items

tests/test_auth.py::TestUserModels::test_user_create_valid FAILED        [  2%]
tests/test_auth.py::TestUserModels::test_user_create_default_role FAILED [  5%]
tests/test_auth.py::TestUserModels::test_user_create_invalid_email FAILED [  7%]
tests/test_auth.py::TestUserModels::test_user_create_short_password FAILED [ 10%]
tests/test_auth.py::TestUserModels::test_user_create_invalid_role FAILED [ 12%]
tests/test_auth.py::TestPricingModels::test_pricing_request_valid FAILED [ 15%]
tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_spot FAILED [ 17%]
tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_option_type FAILED [ 20%]
tests/test_auth.py::TestOAuthUrls::test_google_oauth_url_structure PASSED [ 23%]
tests/test_auth.py::TestOAuthUrls::test_github_oauth_url_structure PASSED [ 25%]
tests/test_auth.py::TestTokenGeneration::test_secure_token_generation PASSED [ 28%]
tests/test_auth.py::TestTokenGeneration::test_tokens_are_unique PASSED   [ 30%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_calculate_technical_indicators_happy_path PASSED [ 33%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_calculate_technical_indicators_insufficient_data PASSED [ 35%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_calculate_technical_indicators_empty_df PASSED [ 38%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_rsi_calculation_increasing PASSED [ 41%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_rsi_calculation_decreasing PASSED [ 43%]
tests/test_feature_engineering.py::TestTechnicalIndicators::test_constant_prices PASSED [ 46%]
tests/test_feature_engineering.py::TestSignalGeneration::test_generate_signals PASSED [ 48%]
tests/test_feature_engineering.py::TestSignalGeneration::test_signal_neutral PASSED [ 51%]
tests/test_pricing.py::TestBlackScholes::test_at_the_money_call PASSED   [ 53%]
tests/test_pricing.py::TestBlackScholes::test_at_the_money_put PASSED    [ 56%]
tests/test_pricing.py::TestBlackScholes::test_put_call_parity PASSED     [ 58%]
tests/test_pricing.py::TestBlackScholes::test_deep_itm_call PASSED       [ 61%]
tests/test_pricing.py::TestBlackScholes::test_deep_otm_call PASSED       [ 64%]
tests/test_pricing.py::TestBlackScholes::test_zero_time_call PASSED      [ 66%]
tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_call FAILED [ 69%]
tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_put FAILED [ 71%]
tests/test_pricing.py::TestCrankNicolson::test_grid_convergence FAILED   [ 74%]
tests/test_pricing.py::TestMonteCarlo::test_accuracy_vs_analytical PASSED [ 76%]
tests/test_pricing.py::TestMonteCarlo::test_antithetic_reduces_variance PASSED [ 79%]
tests/test_pricing.py::TestMonteCarlo::test_reproducibility_with_seed PASSED [ 82%]
tests/test_pricing.py::TestTrinomialTree::test_accuracy_vs_analytical PASSED [ 84%]
tests/test_pricing.py::TestTrinomialTree::test_richardson_extrapolation_improves_accuracy PASSED [ 87%]
tests/test_pricing.py::TestNumericalMethodComparator::test_all_methods_return_results FAILED [ 89%]
tests/test_pricing.py::TestNumericalMethodComparator::test_timing_information FAILED [ 92%]
tests/test_pricing.py::TestEdgeCases::test_high_volatility PASSED        [ 94%]
tests/test_pricing.py::TestEdgeCases::test_very_short_maturity PASSED    [ 97%]
tests/test_pricing.py::TestEdgeCases::test_zero_rate PASSED              [100%]

=================================== FAILURES ===================================
____________________ TestUserModels.test_user_create_valid _____________________
tests/test_auth.py:18: in test_user_create_valid
    from src.api.main import UserCreate
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
_________________ TestUserModels.test_user_create_default_role _________________
tests/test_auth.py:29: in test_user_create_default_role
    from src.api.main import UserCreate
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
________________ TestUserModels.test_user_create_invalid_email _________________
tests/test_auth.py:35: in test_user_create_invalid_email
    from src.api.main import UserCreate
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
________________ TestUserModels.test_user_create_short_password ________________
tests/test_auth.py:42: in test_user_create_short_password
    from src.api.main import UserCreate
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
_________________ TestUserModels.test_user_create_invalid_role _________________
tests/test_auth.py:49: in test_user_create_invalid_role
    from src.api.main import UserCreate
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
_________________ TestPricingModels.test_pricing_request_valid _________________
tests/test_auth.py:64: in test_pricing_request_valid
    from src.api.main import PricingRequest
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
_____________ TestPricingModels.test_pricing_request_invalid_spot ______________
tests/test_auth.py:78: in test_pricing_request_invalid_spot
    from src.api.main import PricingRequest
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
__________ TestPricingModels.test_pricing_request_invalid_option_type __________
tests/test_auth.py:92: in test_pricing_request_invalid_option_type
    from src.api.main import PricingRequest
src/api/main.py:19: in <module>
    from src.api.routers import auth, pricing, trading, user
src/api/routers/__init__.py:1: in <module>
    from . import auth, pricing, trading, user
src/api/routers/auth.py:12: in <module>
    from src.api.deps import get_current_user
src/api/deps.py:9: in <module>
    from src.models.user import User, Session as UserSession
E   ModuleNotFoundError: No module named 'src.models'
______________ TestCrankNicolson.test_accuracy_vs_analytical_call ______________
tests/test_pricing.py:98: in test_accuracy_vs_analytical_call
    fdm = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call", M=200)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
______________ TestCrankNicolson.test_accuracy_vs_analytical_put _______________
tests/test_pricing.py:106: in test_accuracy_vs_analytical_put
    fdm = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "put", M=200)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
___________________ TestCrankNicolson.test_grid_convergence ____________________
tests/test_pricing.py:115: in test_grid_convergence
    coarse = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call", M=50)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (46,) (48,)
________ TestNumericalMethodComparator.test_all_methods_return_results _________
tests/test_pricing.py:204: in test_all_methods_return_results
    results = comparator.compare_all(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:362: in compare_all
    fdm = crank_nicolson_price(S, K, r, sigma, T, option_type, M=self.fdm_grid_size)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (96,) (98,)
____________ TestNumericalMethodComparator.test_timing_information _____________
tests/test_pricing.py:219: in test_timing_information
    results = comparator.compare_all(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:362: in compare_all
    fdm = crank_nicolson_price(S, K, r, sigma, T, option_type, M=self.fdm_grid_size)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
=============================== warnings summary ===============================
tests/test_feature_engineering.py:7
  /app/tests/test_feature_engineering.py:7: DeprecationWarning:
  Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
  (to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
  but was not found to be installed on your system.
  If this would cause problems for you,
  please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466

    import pandas as pd

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_auth.py::TestUserModels::test_user_create_valid - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestUserModels::test_user_create_default_role - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestUserModels::test_user_create_invalid_email - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestUserModels::test_user_create_short_password - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestUserModels::test_user_create_invalid_role - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_valid - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_spot - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_option_type - ModuleNotFoundError: No module named 'src.models'
FAILED tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_call - ValueError: operands could not be broadcast together with shapes (196,) (198,)
FAILED tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_put - ValueError: operands could not be broadcast together with shapes (196,) (198,)
FAILED tests/test_pricing.py::TestCrankNicolson::test_grid_convergence - ValueError: operands could not be broadcast together with shapes (46,) (48,)
FAILED tests/test_pricing.py::TestNumericalMethodComparator::test_all_methods_return_results - ValueError: operands could not be broadcast together with shapes (96,) (98,)
FAILED tests/test_pricing.py::TestNumericalMethodComparator::test_timing_information - ValueError: operands could not be broadcast together with shapes (196,) (198,)
=================== 13 failed, 26 passed, 1 warning in 2.38s ===================

Tests finished with exit code 1
