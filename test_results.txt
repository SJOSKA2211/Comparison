Starting tests...
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0 -- /home/jules/.pyenv/versions/3.12.12/bin/python3
cachedir: .pytest_cache
rootdir: /app
configfile: pyproject.toml
plugins: asyncio-1.3.0, anyio-4.12.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 32 items

tests/test_auth.py::TestUserModels::test_user_create_valid FAILED        [  3%]
tests/test_auth.py::TestUserModels::test_user_create_default_role FAILED [  6%]
tests/test_auth.py::TestUserModels::test_user_create_invalid_email FAILED [  9%]
tests/test_auth.py::TestUserModels::test_user_create_short_password FAILED [ 12%]
tests/test_auth.py::TestUserModels::test_user_create_invalid_role FAILED [ 15%]
tests/test_auth.py::TestPricingModels::test_pricing_request_valid FAILED [ 18%]
tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_spot FAILED [ 21%]
tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_option_type FAILED [ 25%]
tests/test_auth.py::TestOAuthUrls::test_google_oauth_url_structure PASSED [ 28%]
tests/test_auth.py::TestOAuthUrls::test_github_oauth_url_structure PASSED [ 31%]
tests/test_auth.py::TestTokenGeneration::test_secure_token_generation PASSED [ 34%]
tests/test_auth.py::TestTokenGeneration::test_tokens_are_unique PASSED   [ 37%]
tests/test_pricing.py::TestBlackScholes::test_at_the_money_call PASSED   [ 40%]
tests/test_pricing.py::TestBlackScholes::test_at_the_money_put PASSED    [ 43%]
tests/test_pricing.py::TestBlackScholes::test_put_call_parity PASSED     [ 46%]
tests/test_pricing.py::TestBlackScholes::test_deep_itm_call PASSED       [ 50%]
tests/test_pricing.py::TestBlackScholes::test_deep_otm_call PASSED       [ 53%]
tests/test_pricing.py::TestBlackScholes::test_zero_time_call PASSED      [ 56%]
tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_call FAILED [ 59%]
tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_put FAILED [ 62%]
tests/test_pricing.py::TestCrankNicolson::test_grid_convergence FAILED   [ 65%]
tests/test_pricing.py::TestMonteCarlo::test_accuracy_vs_analytical PASSED [ 68%]
tests/test_pricing.py::TestMonteCarlo::test_antithetic_reduces_variance PASSED [ 71%]
tests/test_pricing.py::TestMonteCarlo::test_reproducibility_with_seed PASSED [ 75%]
tests/test_pricing.py::TestTrinomialTree::test_accuracy_vs_analytical PASSED [ 78%]
tests/test_pricing.py::TestTrinomialTree::test_richardson_extrapolation_improves_accuracy PASSED [ 81%]
tests/test_pricing.py::TestNumericalMethodComparator::test_all_methods_return_results FAILED [ 84%]
tests/test_pricing.py::TestNumericalMethodComparator::test_timing_information FAILED [ 87%]
tests/test_pricing.py::TestEdgeCases::test_high_volatility PASSED        [ 90%]
tests/test_pricing.py::TestEdgeCases::test_very_short_maturity PASSED    [ 93%]
tests/test_pricing.py::TestEdgeCases::test_zero_rate PASSED              [ 96%]
tests/test_trading_impl.py::test_get_portfolio_prices_implementation PASSED [100%]

=================================== FAILURES ===================================
____________________ TestUserModels.test_user_create_valid _____________________
tests/test_auth.py:18: in test_user_create_valid
    from src.api.main import UserCreate
E   ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
_________________ TestUserModels.test_user_create_default_role _________________
tests/test_auth.py:29: in test_user_create_default_role
    from src.api.main import UserCreate
E   ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
________________ TestUserModels.test_user_create_invalid_email _________________
tests/test_auth.py:35: in test_user_create_invalid_email
    from src.api.main import UserCreate
E   ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
________________ TestUserModels.test_user_create_short_password ________________
tests/test_auth.py:42: in test_user_create_short_password
    from src.api.main import UserCreate
E   ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
_________________ TestUserModels.test_user_create_invalid_role _________________
tests/test_auth.py:49: in test_user_create_invalid_role
    from src.api.main import UserCreate
E   ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
_________________ TestPricingModels.test_pricing_request_valid _________________
tests/test_auth.py:64: in test_pricing_request_valid
    from src.api.main import PricingRequest
E   ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
_____________ TestPricingModels.test_pricing_request_invalid_spot ______________
tests/test_auth.py:78: in test_pricing_request_invalid_spot
    from src.api.main import PricingRequest
E   ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
__________ TestPricingModels.test_pricing_request_invalid_option_type __________
tests/test_auth.py:92: in test_pricing_request_invalid_option_type
    from src.api.main import PricingRequest
E   ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
______________ TestCrankNicolson.test_accuracy_vs_analytical_call ______________
tests/test_pricing.py:98: in test_accuracy_vs_analytical_call
    fdm = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call", M=200)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
______________ TestCrankNicolson.test_accuracy_vs_analytical_put _______________
tests/test_pricing.py:106: in test_accuracy_vs_analytical_put
    fdm = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "put", M=200)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
___________________ TestCrankNicolson.test_grid_convergence ____________________
tests/test_pricing.py:115: in test_grid_convergence
    coarse = crank_nicolson_price(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call", M=50)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (46,) (48,)
________ TestNumericalMethodComparator.test_all_methods_return_results _________
tests/test_pricing.py:204: in test_all_methods_return_results
    results = comparator.compare_all(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:362: in compare_all
    fdm = crank_nicolson_price(S, K, r, sigma, T, option_type, M=self.fdm_grid_size)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (96,) (98,)
____________ TestNumericalMethodComparator.test_timing_information _____________
tests/test_pricing.py:219: in test_timing_information
    results = comparator.compare_all(SPOT, STRIKE, RATE, VOLATILITY, TIME, "call")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:362: in compare_all
    fdm = crank_nicolson_price(S, K, r, sigma, T, option_type, M=self.fdm_grid_size)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/pricing/numerical_methods.py:151: in crank_nicolson_price
    rhs[1:-1] = B_lower[1:-1] * V[1:-2] + B_diag[1:-1] * V[2:-1] + B_upper[1:-1] * V[3:-1]
                ^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: operands could not be broadcast together with shapes (196,) (198,)
=============================== warnings summary ===============================
../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_auth.py::TestUserModels::test_user_create_valid - ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestUserModels::test_user_create_default_role - ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestUserModels::test_user_create_invalid_email - ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestUserModels::test_user_create_short_password - ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestUserModels::test_user_create_invalid_role - ImportError: cannot import name 'UserCreate' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_valid - ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_spot - ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_auth.py::TestPricingModels::test_pricing_request_invalid_option_type - ImportError: cannot import name 'PricingRequest' from 'src.api.main' (/app/src/api/main.py)
FAILED tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_call - ValueError: operands could not be broadcast together with shapes (196,) (198,)
FAILED tests/test_pricing.py::TestCrankNicolson::test_accuracy_vs_analytical_put - ValueError: operands could not be broadcast together with shapes (196,) (198,)
FAILED tests/test_pricing.py::TestCrankNicolson::test_grid_convergence - ValueError: operands could not be broadcast together with shapes (46,) (48,)
FAILED tests/test_pricing.py::TestNumericalMethodComparator::test_all_methods_return_results - ValueError: operands could not be broadcast together with shapes (96,) (98,)
FAILED tests/test_pricing.py::TestNumericalMethodComparator::test_timing_information - ValueError: operands could not be broadcast together with shapes (196,) (198,)
=================== 13 failed, 19 passed, 1 warning in 2.85s ===================

Tests finished with exit code 1
